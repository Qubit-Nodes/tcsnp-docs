**TCSNP (Transmittable Common Server Network Protocol)**

---

### **1. Введение**

TCSNP — протокол нового поколения, объединяющий децентрализацию, криптографическую анонимность и устойчивость к цензуре. Основные возможности:

* **Анонимизация метаданных** через Onion-маршрутизацию, фиктивный трафик и временные идентификаторы.
* **Отказ от блокчейна** в пользу Onion-DHT с динамической репликацией и слепыми репутационными метриками.
* **Сопротивление анализу трафика** за счёт обфускации пакетов, псевдонимизации узлов и фиксированного размера сообщений.
* **P2P-архитектура**: все ноды одновременно — серверы и клиенты.
* **Двойная репутационная система**: автоматическая (на основе успешных обменов) и пользовательская (голоса, оценки).

---

### **2. Архитектура**

#### **2.1. Компоненты системы**

* **Гварды**: uptime > 95%, репутация > 90.
* **Ретрансляторы**: промежуточные узлы Onion-маршрута.
* **Сервис-ноды**: хранение и выдача данных.
* **Exit-ноды** (опция): прокси в «обычный» Интернет через анонимный мост.

#### **2.2. Onion-DHT (три слоя)**

1. Публичные ключи гвардов и ретрансляторов.
2. Анонимные хеши сервис-нод без гео-привязки.
3. Шардированные метаданные с XOR-обфускацией и солью.

---

### **3. Присоединение ноды**

#### **3.1. Анонимная инициализация**

1. Генерация одноразовой пары ключей Ed25519 → `temp_id` (HMAC-BLAKE3).
2. Onion-Discovery: три случайных гварда снимают слои шифрования.
3. Регистрация: подписанный запрос в DHT с `temp_id`, зашифрованными метаданными и маршрутом.

#### **3.2. Stake-депозит и PoW**

* Нода вносит символический стейк перед регистрацией; штраф за злонамеренность.
* Перед регистрацией дополнительно PoW (Hashcash-стиль), сложность зависит от нагрузки.

---

### **4. Onion-маршрутизация**

#### **4.1. Формирование цепочки**

* Стандартная цепочка: Клиент → 2 гварда → 2 ретранслятора → сервис-нода.
* Для ускорения: опционально два параллельных FastCircuit-маршрута с агрегированием ответов.

#### **4.2. Шифрование и маскировка**

* Многослойное шифрование (как в Tor) и фиксированный размер пакета 1024 байт.
* Периодическая отправка ложных зашифрованных пакетов.
* Разделение управляющего и пользовательского трафика по разным маршрутам.

---

### **5. Анонимный обмен данными**

#### **5.1. Garlic Messaging**

* Несколько вложенных сообщений в одном пакете.
* Для каждой сессии уникальный `session_id`, не связанный с `temp_id`.

#### **5.2. Слепые запросы к DHT**

* Bloom-фильтр маскирует запросы, возвращаются дополнительные записи.
* Диапазонные параметры (например, `EU:00…EU:FF`) вместо точных значений.

---

### **6. Репутационная система**

#### **6.1. Слепые токены и аудит**

* При успешной передаче получатель выдаёт Chaumian-токен, микшер меняет связи «токен ↔ репутация».
* «Мини-блокчейн» в слое 3 DHT для анонимного аудита объёмов и частоты токенов.

#### **6.2. Взвешенное голосование пользователей**

* Голос пользователя весит пропорционально его репутации, но ≤ ×2.
* Anti-collusion: детектирование взаимных голосований и понижение веса группы.

#### **6.3. Деградация и исключение**

* Репутация снижается при отказе > 5 % запросов за час.
* Репутация < 30 → исключение из DHT на 24 ч.

---

### **7. Безопасность и анонимность**

* **Ротация цепочек** каждые 10 мин.
* **Сброс сессий** и ключей при простое > 5 мин.
* **Квантово-безопасное шифрование** NTRUEncrypt для критичных операций.
* **Rate-limit + Proof-of-Bandwidth**: лимиты соединений по репутации и лёгкие Hashcash-задачи при всплесках.

---

### **8. Оптимизации производительности**

* **ECDH-Precompute**: предвычисленные ключи с активными гвардами.
* **Adaptive Congestion Control**: динамическая настройка окна и количества ложных пакетов по RTT и потерь.
* **Multiplexed Streams**: несколько логических каналов в одном Onion-туннеле.
* **Локальные микросети**: прямой обмен в подсети через Noise Protocol Framework.
* **Искусственный джиттер** (0–100 мс) для маскировки геолокации.

---

### **9. Анонимный Интернет-мост (Exit-Bridge)**

#### **9.1. Архитектура моста**

* Добровольные Exit-ноды (`exit=true`) проксируют трафик в публичный Интернет.
* FastBridge Overlay поверх DHT с QUIC-транспортом.

#### **9.2. Анонимность и QoS**

* Запрос → три случайных моста из пула с хорошей репутацией, смена цепочки каждые 5 мин.
* Двойное шифрование: внутри Onion + TLS-туннель к конечному ресурсу.
* Балансировка по заявленной пропускной способности (Bandwidth Auction) и задержкам (Latency-Aware Routing).

---

### **10. Миграция и совместимость**

1. **Версионирование DHT-записей**: новые поля игнорируются старыми нодами.
2. **Фазовый rollout**:

   * этап 1: Proof-of-Bandwidth, ECDH-Precompute;
   * этап 2: Stake-депозиты;
   * этап 3: запуск Exit-bridge.
3. **Телеметрия**: lightweight-агенты собирают анонимные метрики отказов и задержек для оракулов репутации.
